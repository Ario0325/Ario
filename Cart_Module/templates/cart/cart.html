{% extends 'shared/base.html' %}
{% load static %}
{% load math_filters %}

{% block title %}Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ - ÙØ±ÙˆØ´Ú¯Ø§Ù‡{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/discount-widget.css' %}">
{% endblock %}

{% block content %}
<div class="page-header text-center" style="background-image: url('/static/assets/images/page-header-bg.jpg')">
    <div class="container">
        <h1 class="page-title">Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯<span>ÙØ±ÙˆØ´Ú¯Ø§Ù‡</span></h1>
    </div>
</div>

<nav aria-label="breadcrumb" class="breadcrumb-nav">
    <div class="container">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'index' %}">Ø®Ø§Ù†Ù‡</a></li>
            <li class="breadcrumb-item"><a href="{% url 'products:list' %}">ÙØ±ÙˆØ´Ú¯Ø§Ù‡</a></li>
            <li class="breadcrumb-item active" aria-current="page">Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</li>
        </ol>
    </div>
</nav>

<div class="page-content">
    <div class="cart">
        <div class="container">
            <div class="row">
                <div class="col-lg-9">
                    <form action="{% url 'cart:update' %}" method="post">
                        {% csrf_token %}
                        <table class="table table-cart table-mobile">
                            <thead>
                                <tr>
                                    <th>Ù…Ø­ØµÙˆÙ„</th>
                                    <th>Ù‚ÛŒÙ…Øª</th>
                                    <th>ØªØ¹Ø¯Ø§Ø¯</th>
                                    <th>Ù…Ø¬Ù…ÙˆØ¹</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in cart_items %}
                                <tr{% if discounted_product_id and item.product.id == discounted_product_id %} class="table-success"{% endif %}>
                                    <td class="product-col">
                                        <div class="product">
                                            <figure class="product-media">
                                                <a href="{{ item.product.get_absolute_url }}">
                                                    {% with item.product.images.all.0 as img %}
                                                    {% if img %}
                                                    <img src="{{ img.image.url }}" alt="{{ item.product.name }}">
                                                    {% else %}
                                                    <img src="{% static 'assets/images/products/product-1.jpg' %}" alt="{{ item.product.name }}">
                                                    {% endif %}
                                                    {% endwith %}
                                                </a>
                                            </figure>
                                            <h3 class="product-title">
                                                <a href="{{ item.product.get_absolute_url }}">{{ item.product.name }}</a>
                                                {% if discounted_product_id and item.product.id == discounted_product_id %}
                                                <span class="badge badge-success" style="font-size:11px;margin-right:4px;">ØªØ®ÙÛŒÙ Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯</span>
                                                {% endif %}
                                            </h3>
                                        </div>
                                    </td>
                                    <td class="price-col">{{ item.price|floatformat:0 }}</td>
                                    <td class="quantity-col">
                                        <div class="cart-product-quantity">
                                            <input type="number" name="qty_{{ item.product.id }}" class="form-control" value="{{ item.quantity }}" min="1" max="{% if item.product.stock %}{{ item.product.stock }}{% else %}99{% endif %}" step="1" data-decimals="0" required>
                                        </div>
                                    </td>
                                    <td class="total-col">{{ item.total|floatformat:0 }}</td>
                                    <td class="remove-col">
                                        <form action="{% url 'cart:remove' item.product.id %}" method="post" class="d-inline">
                                            {% csrf_token %}
                                            <input type="hidden" name="next" value="{{ request.path }}">
                                            <button type="submit" class="btn-remove" title="Ø­Ø°Ù Ù…Ø­ØµÙˆÙ„"><i class="icon-close"></i></button>
                                        </form>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>

                        <div class="cart-bottom">
                            {# â”€â”€ ÙˆÛŒØ¬Øª Ú©Ø¯ ØªØ®ÙÛŒÙ â”€â”€ #}
                            <div class="cart-discount">
                                <div class="discount-widget">
                                    <div class="discount-widget__surface"></div>

                                    {# Ù‡Ø¯Ø± ÙˆÛŒØ¬Øª #}
                                    <div class="discount-widget__header">
                                        <div class="discount-widget__title-group">
                                            <span class="discount-widget__icon" aria-hidden="true">ğŸ·ï¸</span>
                                            <span class="discount-widget__title">Ú©Ø¯ ØªØ®ÙÛŒÙ</span>
                                        </div>
                                        {% if discount_code %}
                                        <span class="discount-widget__badge discount-widget__badge--active">ÙØ¹Ø§Ù„</span>
                                        {% else %}
                                        <span class="discount-widget__badge">Ø¯Ø§Ø±ÛŒØ¯ØŸ</span>
                                        {% endif %}
                                    </div>

                                    {% if discount_code %}
                                    {# Ø­Ø§Ù„Øª: Ú©Ø¯ ØªØ®ÙÛŒÙ ÙØ¹Ø§Ù„ Ø§Ø³Øª #}
                                    <div class="discount-widget__active" id="coupon-active-code">
                                        <div class="discount-widget__active-info">
                                            <span class="discount-widget__active-label">Ú©Ø¯ ÙØ¹Ø§Ù„:</span>
                                            <span class="discount-widget__active-code">{{ discount_code.code }}</span>
                                            {% if discount_code.scope == 'product' and discount_code.product %}
                                            <span class="discount-widget__active-scope">
                                                (Ù…Ø®ØµÙˆØµ: {{ discount_code.product.name }})
                                            </span>
                                            {% endif %}
                                        </div>
                                        <div class="discount-widget__active-amount" id="summary-discount-amount">
                                            <span class="discount-widget__active-amount-label">ØªØ®ÙÛŒÙ:</span>
                                            <span class="discount-widget__active-amount-value">{{ discount_amount|floatformat:0 }} ØªÙˆÙ…Ø§Ù†</span>
                                        </div>
                                        <form action="{% url 'cart:discount_remove' %}" method="post" class="discount-widget__remove-form">
                                            {% csrf_token %}
                                            <button type="submit" class="discount-widget__remove-btn" title="Ø­Ø°Ù Ú©Ø¯ ØªØ®ÙÛŒÙ">
                                                <span class="discount-widget__remove-icon">âœ•</span>
                                                <span class="discount-widget__remove-text">Ø­Ø°Ù Ú©Ø¯</span>
                                            </button>
                                        </form>
                                    </div>
                                    {# ÙØ±Ù… Ù…Ø®ÙÛŒ Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ± Ú©Ø¯ - Ù‡Ù…ÛŒØ´Ù‡ URL Ø§Ø¹Ù…Ø§Ù„ Ú©Ø¯ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ø§Ø³Øª #}
                                    <div class="discount-widget__form mt-2" style="display:none;" aria-hidden="true">
                                        <form action="{% url 'cart:discount_apply' %}" method="post" class="discount-widget__form-inner">
                                            {% csrf_token %}
                                        </form>
                                    </div>
                                    {% else %}
                                    {# Ø­Ø§Ù„Øª: ÙØ±Ù… ÙˆØ±ÙˆØ¯ Ú©Ø¯ ØªØ®ÙÛŒÙ #}
                                    <div class="discount-widget__form">
                                        <form action="{% url 'cart:discount_apply' %}" method="post" class="discount-widget__form-inner">
                                            {% csrf_token %}
                                            <div class="input-group discount-widget__input-group">
                                                <input
                                                    type="text"
                                                    class="form-control discount-widget__input"
                                                    placeholder="Ú©Ø¯ ØªØ®ÙÛŒÙ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯"
                                                    name="code"
                                                    autocomplete="off"
                                                    autocapitalize="characters"
                                                    maxlength="50"
                                                    aria-label="Ú©Ø¯ ØªØ®ÙÛŒÙ"
                                                >
                                                <div class="input-group-append">
                                                    <button class="btn btn-outline-primary-2 discount-widget__submit-btn" type="submit">
                                                        <span class="discount-widget__submit-text">Ø§Ø¹Ù…Ø§Ù„ Ú©Ø¯</span>
                                                        <i class="icon-long-arrow-left discount-widget__submit-icon"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <button type="submit" class="btn btn-outline-dark-2"><span>Ø¨Ù‡ Ø±ÙˆØ² Ø±Ø³Ø§Ù†ÛŒ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</span><i class="icon-refresh"></i></button>
                        </div>
                    </form>
                </div>

                <aside class="col-lg-3">
                    <div class="summary summary-cart">
                        <h3 class="summary-title">Ø¬Ù…Ø¹ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</h3>
                        <table class="table table-summary">
                            <tbody>
                                <tr class="summary-subtotal">
                                    <td>Ø¬Ù…Ø¹ Ú©Ù„ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ :</td>
                                    <td class="text-left">{{ cart_total|floatformat:0 }} ØªÙˆÙ…Ø§Ù†</td>
                                </tr>
                                {% if discount_code and discount_amount %}
                                <tr class="summary-discount" style="color:#c62828;">
                                    <td>ØªØ®ÙÛŒÙ ({{ discount_code.code }}) :</td>
                                    <td class="text-left">- {{ discount_amount|floatformat:0 }} ØªÙˆÙ…Ø§Ù†</td>
                                </tr>
                                {% endif %}
                                <tr class="summary-shipping">
                                    <td>Ø´ÛŒÙˆÙ‡ Ø§Ø±Ø³Ø§Ù„ :</td>
                                    <td>&nbsp;</td>
                                </tr>
                                <tr class="summary-shipping-row">
                                    <td>
                                        <div class="custom-control custom-radio">
                                            <input type="radio" id="free-shipping" name="shipping" class="custom-control-input" checked>
                                            <label class="custom-control-label" for="free-shipping">Ø§Ø±Ø³Ø§Ù„ Ø±Ø§ÛŒÚ¯Ø§Ù†</label>
                                        </div>
                                    </td>
                                    <td class="text-left">0 ØªÙˆÙ…Ø§Ù†</td>
                                </tr>
                                {% if user.is_authenticated %}
                                <tr class="summary-shipping-estimate">
                                    <td>Ø¢Ø¯Ø±Ø³<br><a href="{% url 'accounts:dashboard' %}">ØªØºÛŒÛŒØ± Ø¢Ø¯Ø±Ø³</a></td>
                                    <td>&nbsp;</td>
                                </tr>
                                {% endif %}
                                <tr class="summary-total">
                                    <td>Ù…Ø¨Ù„Øº Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª :</td>
                                    <td class="text-left">{{ total_payable|floatformat:0 }} ØªÙˆÙ…Ø§Ù†</td>
                                </tr>
                            </tbody>
                        </table>
                        <a href="{% url 'cart:checkout' %}" class="btn btn-outline-primary-2 btn-order btn-block">Ø±ÙØªÙ† Ø¨Ù‡ ØµÙØ­Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª</a>
                    </div>
                    <a href="{% url 'products:list' %}" class="btn btn-outline-dark-2 btn-block mb-3"><span>Ø§Ø¯Ø§Ù…Ù‡ Ø®Ø±ÛŒØ¯</span><i class="icon-refresh"></i></a>
                </aside>
            </div>
        </div>
    </div>
</div>
{% endblock %}
